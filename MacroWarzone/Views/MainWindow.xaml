<Window x:Class="MacroWarzone.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:MacroWarzone.ViewModels"
        Title="Nexus Services" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#0A0E27"
        ResizeMode="CanResize"
        WindowState="Maximized"
        Icon="pack://application:,,,/Assets/Nexus12.ico">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>

        <!---UI SCALE-->
        <ScaleTransform x:Key="UiScale" ScaleX="1.0" ScaleY="1.0"/>

        <!-- ==================== COLORI ==================== -->
        <SolidColorBrush x:Key="BackgroundDark" Color="#0A0E27"/>

        <LinearGradientBrush x:Key="CardBackground" StartPoint="0,0" EndPoint="1,1">
            <!-- Viola scuro elegante -->
            <GradientStop Color="#1A1B3A" Offset="0.0"/>
            <!-- Viola/blu intermedio -->
            <GradientStop Color="#252847" Offset="0.5"/>
            <!-- Ritorno viola scuro -->
            <GradientStop Color="#1A1B3A" Offset="1.0"/>
        </LinearGradientBrush>

        <SolidColorBrush x:Key="AccentBlue" Color="#1E88E5"/>
        <SolidColorBrush x:Key="AccentBlueLight" Color="#64B5F6"/>
        <SolidColorBrush x:Key="SuccessGreen" Color="#4CAF50"/>
        <SolidColorBrush x:Key="ErrorRed" Color="#EF5350"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#9E9E9E"/>
        <SolidColorBrush x:Key="BorderColor" Color="#1E88E5"/>
        <!-- Aggiungi queste nuove brush -->
        <SolidColorBrush x:Key="ZenBlue" Color="#60A5FA"/>
        <SolidColorBrush x:Key="ZenPink" Color="#F472B6"/>
        <SolidColorBrush x:Key="ZenYellow" Color="#FCD34D"/>
        <SolidColorBrush x:Key="ZenGreen" Color="#34D399"/>
        <SolidColorBrush x:Key="ZenOrange" Color="#FF6B35"/>

        <!-- ==================== STILI GLOBALI ==================== -->

        <!-- Header principale -->
        <Style x:Key="TitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource AccentBlueLight}"/>
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>

        <!-- Sottotitolo -->
        <Style x:Key="SubtitleStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>

        <!-- Header sezione -->
        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource AccentBlue}"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,15,0,10"/>
        </Style>

        <!-- Label parametro -->
        <Style x:Key="ParamLabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
        </Style>

        <!-- Valore parametro -->
        <Style x:Key="ParamValueStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="MinWidth" Value="50"/>
            <Setter Property="TextAlignment" Value="Right"/>
        </Style>

        <!-- ==================== CHECKBOX PERSONALIZZATA ==================== -->
        <Style x:Key="MacroCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <!-- Custom checkbox box -->
                            <Border x:Name="CheckBoxBorder"
                                    Width="24" Height="24"
                                    Background="Transparent"
                                    BorderBrush="Violet"
                                    BorderThickness="2"
                                    CornerRadius="4"
                                    Margin="0,0,10,0">
                                <Path x:Name="CheckMark"
                                      Data="M 2,6 L 8,12 L 18,2"
                                      Stroke="{StaticResource SuccessGreen}"
                                      StrokeThickness="3"
                                      Visibility="Collapsed"
                                      Margin="2"/>
                            </Border>
                            <ContentPresenter VerticalAlignment="Center"/>
                        </StackPanel>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="CheckBoxBorder" Property="Background" Value="#1A4CAF50"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="CheckBoxBorder" Property="BorderBrush" Value="{StaticResource AccentBlueLight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ==================== SLIDER PERSONALIZZATO ==================== -->
        <Style x:Key="MacroSlider" TargetType="Slider">
            <Setter Property="Height" Value="14"/>
            <Setter Property="Margin" Value="10,12,10,12"/>
            <Setter Property="Foreground" Value="#A855F7"/>
            <Setter Property="Background" Value="#1E293B"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto" MinHeight="{TemplateBinding MinHeight}"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Track -->
                            <Border Grid.Row="1"
                            Height="6"
                            Background="{TemplateBinding Background}"
                            CornerRadius="3"
                            VerticalAlignment="Center">
                                <!-- Progress bar -->
                                <Border x:Name="PART_SelectionRange"
                                HorizontalAlignment="Left"
                                Background="{TemplateBinding Foreground}"
                                CornerRadius="3"
                                Height="6"/>
                            </Border>

                            <!-- Thumb (pallina slider) -->
                            <Track Grid.Row="1" x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate>
                                                <Grid>
                                                    <!-- Glow effect -->
                                                    <Ellipse Width="20" Height="20"
                                                     Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Slider}}"
                                                     Opacity="0.3"/>
                                                    <!-- Core thumb -->
                                                    <Ellipse Width="16" Height="16"
                                                     Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Slider}}"
                                                     Stroke="White"
                                                     StrokeThickness="2"/>
                                                </Grid>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>

                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ==================== PULSANTI ==================== -->
        <!-- =========================
     CYBERPUNK BUTTONS (keep same keys)
     ========================= -->

        <Style x:Key="BaseButton" TargetType="Button">
            <!-- Base typography -->
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Background" Value="#161A22"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>

            <!-- RenderOptions for crisp edges -->
            <Setter Property="RenderOptions.EdgeMode" Value="Aliased"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="Root" SnapsToDevicePixels="True">
                            <!-- Soft glow behind (neon vibe) -->
                            <Border x:Name="Glow"
                            CornerRadius="10"
                            Opacity="0.0"
                            Background="Transparent"
                            BorderThickness="1"
                            BorderBrush="{TemplateBinding BorderBrush}">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="22"
                                              ShadowDepth="0"
                                              Opacity="0.85"
                                              Color="#1E88E5"/>
                                </Border.Effect>
                            </Border>

                            <!-- Main shell -->
                            <Border x:Name="Shell"
                            CornerRadius="10"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">

                                <Grid>
                                    <!-- Top sheen -->
                                    <Border x:Name="Sheen"
                                    CornerRadius="10"
                                    Opacity="0.0">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                <GradientStop Color="#66FFFFFF" Offset="0"/>
                                                <GradientStop Color="#00FFFFFF" Offset="0.55"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>

                                    <!-- Subtle diagonal scanline -->
                                    <Rectangle x:Name="Scan"
                                       Opacity="0.10"
                                       IsHitTestVisible="False">
                                        <Rectangle.Fill>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#00FFFFFF" Offset="0.0"/>
                                                <GradientStop Color="#22FFFFFF" Offset="0.35"/>
                                                <GradientStop Color="#00FFFFFF" Offset="0.7"/>
                                                <GradientStop Color="#22FFFFFF" Offset="1.0"/>
                                            </LinearGradientBrush>
                                        </Rectangle.Fill>
                                    </Rectangle>

                                    <!-- Content -->
                                    <Grid Margin="{TemplateBinding Padding}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left neon tick -->
                                        <Border x:Name="Tick"
                                        Width="4"
                                        CornerRadius="2"
                                        Background="{TemplateBinding BorderBrush}"
                                        Opacity="0.85"
                                        VerticalAlignment="Stretch"/>

                                        <ContentPresenter Grid.Column="1"
                                                  Margin="12,0,12,0"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  RecognizesAccessKey="True"/>

                                        <!-- Right tiny corner notch -->
                                        <Path Grid.Column="2"
                                      Width="12" Height="12"
                                      Margin="0,1,0,0"
                                      HorizontalAlignment="Right"
                                      VerticalAlignment="Top"
                                      Opacity="0.65"
                                      Fill="{TemplateBinding BorderBrush}"
                                      Data="M0,0 L12,0 L12,3 L3,12 L0,12 Z"/>
                                    </Grid>
                                </Grid>
                            </Border>

                            <!-- Press overlay -->
                            <Border x:Name="PressOverlay"
                            CornerRadius="10"
                            Opacity="0.0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="#00FFFFFF" Offset="0"/>
                                        <GradientStop Color="#33FFFFFF" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <!-- Hover: glow + sheen -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Glow" Property="Opacity" Value="1"/>
                                <Setter TargetName="Sheen" Property="Opacity" Value="0.35"/>
                                <Setter TargetName="Scan" Property="Opacity" Value="0.16"/>
                            </Trigger>

                            <!-- Press: tighter glow + press overlay -->
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Glow" Property="Opacity" Value="1"/>
                                <Setter TargetName="PressOverlay" Property="Opacity" Value="0.35"/>
                                <Setter TargetName="Shell" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.985" ScaleY="0.985"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Shell" Property="RenderTransformOrigin" Value="0.5,0.5"/>
                            </Trigger>

                            <!-- Disabled: dead neon -->
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.45"/>
                                <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                <Setter TargetName="Glow" Property="Opacity" Value="0"/>
                                <Setter TargetName="Scan" Property="Opacity" Value="0.06"/>
                                <Setter TargetName="Tick" Property="Opacity" Value="0.35"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- START: green cyber glow -->
        <Style x:Key="StartButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#141B18"/>
            <Setter Property="BorderBrush" Value="{StaticResource ZenGreen}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#16231D"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- STOP: red/pink aggressive glow -->
        <Style x:Key="StopButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#1C1416"/>
            <Setter Property="BorderBrush" Value="{StaticResource ZenPink}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#27161A"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- BLUE: neon blue glow -->
        <Style x:Key="BlueButton" TargetType="Button" BasedOn="{StaticResource BaseButton}">
            <Setter Property="Background" Value="#141824"/>
            <Setter Property="BorderBrush" Value="{StaticResource ZenBlue}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#162033"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- ==================== CARD CONTAINER ==================== -->
        <Style x:Key="MacroCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="#1E88E533"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>

        <!-- ==================== SCROLLVIEWER ==================== -->
        <Style TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>

        <!-- ==================== COMBOBOX + WEAPON SETTINGS ==================== -->
        <!-- ComboBox in tema -->
        <!-- Items del dropdown -->
        <Style x:Key="MacroComboBox1" TargetType="ComboBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#0A0E27"/>
            <Setter Property="BorderBrush" Value="#1E88E5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <!--<Setter Property="ItemContainerStyle" Value="{StaticResource MacroComboBoxItem}"/>-->

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <!-- BOX CHIUSO -->
                            <Border x:Name="Bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="6"
                            SnapsToDevicePixels="True">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Selected item presenter -->
                                    <ContentPresenter x:Name="ContentSite"
                  Margin="{TemplateBinding Padding}"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Left"
                  Content="{Binding SelectedItem, RelativeSource={RelativeSource TemplatedParent}}">
                                        <ContentPresenter.ContentTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Name}"  Foreground="White"/>
                                            </DataTemplate>
                                        </ContentPresenter.ContentTemplate>
                                    </ContentPresenter>


                                    <!-- Editable TextBox (quando IsEditable=True) -->
                                    <TextBox x:Name="PART_EditableTextBox"
                                     Grid.Column="0"
                                     Margin="{TemplateBinding Padding}"
                                     VerticalAlignment="Center"
                                     Background="Transparent"
                                     Foreground="{TemplateBinding Foreground}"
                                     BorderThickness="0"
                                     IsReadOnly="{TemplateBinding IsReadOnly}"
                                     Visibility="Hidden"
                                     Focusable="True"
                                     Text="{Binding SelectedItem.Name,
                                        RelativeSource={RelativeSource TemplatedParent},
                                        Mode=OneWay, 
                                        TargetNullValue=''}"/>


                                    <!-- Freccia -->
                                    <ToggleButton x:Name="DropDownToggle"
                                                  Grid.Column="1"
                                                  Focusable="False"
                                                  IsChecked="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}"
                                                  Background="#141B3D"
                                                  BorderBrush="{TemplateBinding BorderBrush}"
                                                  BorderThickness="1,0,0,0">
                                        <ToggleButton.Template>
                                            <ControlTemplate TargetType="ToggleButton">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="0,6,6,0">
                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </ToggleButton.Template>

                                        <Path Data="M 0 0 L 6 6 L 12 0 Z"
                                              Fill="White"
                                              Width="12"
                                              Height="6"
                                              Stretch="Fill"
                                              Opacity="0.9"/>
                                    </ToggleButton>

                                </Grid>
                            </Border>

                            <!-- POPUP DROPDOWN -->
                            <Popup x:Name="PART_Popup"
                           Placement="Bottom"
                           IsOpen="{TemplateBinding IsDropDownOpen}"
                           AllowsTransparency="True"
                           Focusable="False"
                           PopupAnimation="Fade"
                           PlacementTarget="{Binding RelativeSource={RelativeSource TemplatedParent}}">
                                <Border Background="#0A0E27"
                                        TextElement.Foreground="White"

                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                SnapsToDevicePixels="True"
                                MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ScrollViewer Margin="0"
                                          SnapsToDevicePixels="True"
                                          CanContentScroll="True">
                                        <!-- QUESTO è quello che WPF vuole -->
                                        <ItemsPresenter/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <!--<Trigger Property="IsEditable" Value="True">
                                <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                            </Trigger>-->

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.55"/>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#64B5F6"/>
                            </Trigger>

                            <Trigger Property="IsKeyboardFocusWithin" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#A855F7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ==================== EXPANDER CARD (HEADER VISIBILE, NO CHECKBOX TOGGLE) ==================== -->
        <Style x:Key="MacroExpanderCard" TargetType="Expander">
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="Background" Value="{StaticResource CardBackground}"/>
            <Setter Property="BorderBrush" Value="#1E88E533"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Expander">
                        <Border x:Name="Root"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="8"
                        SnapsToDevicePixels="True">

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- HEADER (padding qui, non su Grid) -->
                                <Border Grid.Row="0"  Padding="14">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="32"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- SOLO la freccia toggla -->
                                        <ToggleButton Grid.Column="0"
                                              Width="24"
                                              Height="24"
                                              Background="Transparent"
                                              BorderThickness="0"
                                              Focusable="False"
                                              IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}">
                                            <Path x:Name="Arrow"
                                          Data="M 0 0 L 8 8 L 16 0 Z"
                                          Fill="Violet"
                                          Stretch="Uniform"
                                          Width="16"
                                          Height="8"
                                          HorizontalAlignment="Center"
                                          VerticalAlignment="Center">
                                                <Path.LayoutTransform>
                                                    <RotateTransform Angle="0" CenterX="8" CenterY="4"/>
                                                </Path.LayoutTransform>
                                            </Path>
                                        </ToggleButton>

                                        <!-- QUI: renderizza DAVVERO l'Header dell'Expander -->
                                        <ContentPresenter Grid.Column="1"
                                                  VerticalAlignment="Center"
                                                  RecognizesAccessKey="True"
                                                  ContentSource="Header"/>
                                    </Grid>
                                </Border>

                                <!-- CONTENT -->
                                <Border x:Name="ContentSite"
                                Grid.Row="1"
                                Padding="20"
                                Background="Transparent"
                                Visibility="Collapsed">
                                    <ContentPresenter/>
                                </Border>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>

                            <Trigger Property="IsExpanded" Value="True">
                                <Setter TargetName="ContentSite" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="Arrow" Property="LayoutTransform">
                                    <Setter.Value>
                                        <RotateTransform Angle="180" CenterX="8" CenterY="4"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsExpanded" Value="False">
                                <Setter TargetName="Arrow" Property="LayoutTransform">
                                    <Setter.Value>
                                        <RotateTransform Angle="0" CenterX="8" CenterY="4"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>

                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="BorderBrush" Value="{StaticResource ErrorRed}"/>
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.5"/>
                            </Trigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!--========================STYLE PER RADIO BUTTON==============================-->
        <Style x:Key="ControllerTypeRadioButton" TargetType="RadioButton">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,15,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="RadioBorder"
                        Background="#1E293B"
                        BorderBrush="#334155"
                        BorderThickness="2"
                        CornerRadius="8"
                        Padding="20,12">
                            <StackPanel Orientation="Horizontal">
                                <!-- Icona controller -->
                                <Ellipse x:Name="RadioDot"
                                 Width="16" Height="16"
                                 Fill="Transparent"
                                 Stroke="{StaticResource AccentBlue}"
                                 StrokeThickness="2"
                                 Margin="0,0,10,0"/>
                                <ContentPresenter VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RadioDot" Property="Fill" Value="{StaticResource AccentBlue}"/>
                                <Setter TargetName="RadioBorder" Property="BorderBrush" Value="{StaticResource AccentBlue}"/>
                                <Setter TargetName="RadioBorder" Property="Background" Value="#1A1E88E5"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RadioBorder" Property="BorderBrush" Value="{StaticResource AccentBlueLight}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


    </Window.Resources>

    <Grid  Margin="20">
        <Grid.Background>
            <ImageBrush ImageSource="/Assets/iridescent-texture-background.jpg"
                     Stretch="UniformToFill"
                     Opacity="0.25"/>
        </Grid.Background>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Pulsanti controllo -->
            <RowDefinition Height="*"/>
            <!-- Contenuto principale -->
        </Grid.RowDefinitions>

        <!-- ==================== PULSANTI CONTROLLO ==================== -->
        <StackPanel Grid.Row="1"
            Orientation="Horizontal"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Margin="0,0,0,20">

            <Button Content="START"
            Command="{Binding StartCommand}"
            Width="120"
            Height="45"
            Margin="0,0,10,0"
            Style="{StaticResource StartButton}"/>

            <Button Content="STOP"
            Command="{Binding StopCommand}"
            Width="120"
            Height="45"
            Margin="0,0,10,0"
            Style="{StaticResource StopButton}"/>

            <Button Content="RESET DATA"  
            Command="{Binding ResetToDefaultCommand}"
            Width="160"
            Height="45"
            Margin="0,0,10,0"
            Style="{StaticResource BlueButton}"/>

            <!-- SAVE (manca) -->
            <Button Content="SAVE"
            Command="{Binding SaveAndReloadMacrosCommand}"
            Width="120"
            Height="45"
            Margin="0,0,20,0"
            Style="{StaticResource BlueButton}"/>

            <RadioButton Content="DualShock 4" Style="{StaticResource ControllerTypeRadioButton}"
                            GroupName="OutputType"
                            Foreground="White"
                            Margin="0,0,15,0"
                            IsChecked="{Binding IsDs4Selected, Mode=TwoWay}"/>

            <RadioButton Content="Xbox 360   " Style="{StaticResource ControllerTypeRadioButton}"
                             GroupName="OutputType"
                             Foreground="White"
                             Margin="0,0,15,0"
                             IsChecked="{Binding IsXboxSelected, Mode=TwoWay}"/>



        </StackPanel>

        <!-- ==================== CONTENUTO PRINCIPALE ==================== -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2.5*"/>
                <!-- Config macro -->
                <ColumnDefinition Width="1*"/>
                <!-- Log -->
            </Grid.ColumnDefinitions>

            <!-- ==================== CONFIGURAZIONE MACRO ==================== -->
            <ScrollViewer Grid.Column="0" Margin="0,0,15,0" RenderTransform="{StaticResource UiScale}">
                <StackPanel>

                    <!-- ==================== REALTIME ADAPTIVE ANTI-RECOIL ==================== -->
                    <Expander IsExpanded="False" Margin="0,15,0,0">
                        <Expander.Header>
                            <Grid>
                                <CheckBox Content="🧠 REALTIME ADAPTIVE ANTI-RECOIL"
                                          IsChecked="{Binding RealtimeAntiRecoilEnabled}"
                                          Style="{StaticResource MacroCheckBox}"
                                          FontSize="18"
                                          Margin="0"/>
                            </Grid>
                        </Expander.Header>

                        <StackPanel IsEnabled="{Binding RealtimeAntiRecoilEnabled}">
                            <TextBlock Text="Adaptive Parameters"
                                       Style="{StaticResource SectionHeaderStyle}"
                                       FontSize="14"
                                       Margin="30,5,0,5"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="170"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="70"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Adaptive Strength" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="0" Grid.Column="1" Value="{Binding AdaptiveStrength}" Minimum="0.5" Maximum="1.5" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding AdaptiveStrength, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Learning Rate" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="1" Grid.Column="1" Value="{Binding LearningRate}" Minimum="0.1" Maximum="0.5" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding LearningRate, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Buffer Size" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="2" Grid.Column="1" Value="{Binding BufferSize}" Minimum="50" Maximum="200" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding BufferSize, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Min Samples" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="3" Grid.Column="1" Value="{Binding MinSamplesForLearning}" Minimum="5" Maximum="20" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding MinSamplesForLearning, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Pattern Lock Threshold" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="4" Grid.Column="1" Value="{Binding PatternLockThreshold}" Minimum="10" Maximum="30" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="4" Grid.Column="2" Text="{Binding PatternLockThreshold, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>
                            </Grid>
                        </StackPanel>
                    </Expander>

                    <!-- ==================== ANTI-RECOIL (NO WEAPON) ==================== -->
                    <Expander  IsExpanded="False" Margin="0,15,0,0">
                        <Expander.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Checkbox + titolo -->
                                <CheckBox Content="ANTI-RECOIL"
                                          IsChecked="{Binding AntiRecoilEnabled}"
                                          Style="{StaticResource MacroCheckBox}"
                                          FontSize="18"
                                          Margin="0"/>
                            </Grid>
                        </Expander.Header>

                        <!-- Corpo -->
                        <StackPanel IsEnabled="{Binding AntiRecoilEnabled}">

                            <!-- Sezione: Compensation -->
                            <TextBlock Text="Compensation"
                                       Style="{StaticResource SectionHeaderStyle}"
                                       FontSize="14"
                                       Margin="30,5,0,5"/>

                            <Border 
                                    Margin="30,0,0,10"
                                    Padding="14"
                                    CornerRadius="8"
                                    BorderBrush="#1E88E533"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="17.867"/>
                                        <ColumnDefinition Width="142.133"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="70"/>
                                    </Grid.ColumnDefinitions>

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Recoil Strength -->

                                    <TextBlock Grid.Column="0"
                                                Text="Strength"
                                                Style="{StaticResource ParamLabelStyle}" 
                                               Grid.ColumnSpan="2" 
                                               Margin="0,0,0 ,0"/>

                                    <Slider Grid.Row="0" Grid.Column="2"
                                            Value="{Binding AntiRecoilStrength}"
                                            Minimum="0" Maximum="1.5"
                                            TickFrequency="0.01"
                                            Style="{StaticResource MacroSlider}" Margin="10,12,10,12"/>

                                    <TextBlock Grid.Column="3"
                                               Text="{Binding AntiRecoilStrength, StringFormat={}{0:F2}}"
                                               Style="{StaticResource ParamValueStyle}"/>

                                    <!-- Vertical Bias -->
                                    <TextBlock Grid.Row="1" Grid.Column="0"
                           Text="Vertical Bias"
                           Style="{StaticResource ParamLabelStyle}" Grid.ColumnSpan="2" Margin="0,0,10,0"/>

                                    <Slider Grid.Row="1" Grid.Column="2"
                        Value="{Binding AntiRecoilVerticalBias}"
                                            Minimum="-1" Maximum="1"
                                            TickFrequency="0.01"
                        Style="{StaticResource MacroSlider}" Margin="10,12,10,12"/>

                                    <TextBlock Grid.Row="1" Grid.Column="3"
                           Text="{Binding AntiRecoilVerticalBias, StringFormat={}{0:F2}, FallbackValue=ERR, TargetNullValue=NULL }"
                           Style="{StaticResource ParamValueStyle}"/>

                                    <!-- Horizontal Bias -->
                                    <TextBlock Grid.Row="2" Grid.Column="0"
                           Text="Horizontal Bias"
                           Style="{StaticResource ParamLabelStyle}" Grid.ColumnSpan="2" Margin="0,0,10,0"/>

                                    <Slider Grid.Row="2" Grid.Column="2"
                        Value="{Binding AntiRecoilHorizontalBias}"
                        Minimum="-1" Maximum="1"
                        TickFrequency="0.01"
                        Style="{StaticResource MacroSlider}" Margin="10,12,10,12"/>

                                    <TextBlock Grid.Row="2" Grid.Column="3"
                           Text="{Binding AntiRecoilHorizontalBias, StringFormat={}{0:F2}}"
                           Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <!-- Sezione: Timing -->
                            <TextBlock Text="Timing"
                                       Style="{StaticResource SectionHeaderStyle}"
                                       FontSize="14"
                                       Margin="30,10,0,5"/>

                            <Border 
                                    Margin="30,0,0,0"
                                    Padding="14"
                                    CornerRadius="8"
                                    BorderBrush="#1E88E533"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="70"/>
                                    </Grid.ColumnDefinitions>

                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Smoothing Tau -->
                                    <TextBlock Grid.Row="0" Grid.Column="0"
                                               Text="Smoothing (ms)"
                                               Style="{StaticResource ParamLabelStyle}"/>

                                    <Slider Grid.Row="0" Grid.Column="1"
                                            Value="{Binding AntiRecoilSmoothingTauMs}"
                                            Minimum="5" Maximum="200"
                                            TickFrequency="1"
                                            Style="{StaticResource MacroSlider}"/>

                                    <TextBlock Grid.Row="0" Grid.Column="2"
                                               Text="{Binding AntiRecoilSmoothingTauMs, StringFormat={}{0:F0}}"
                                               Style="{StaticResource ParamValueStyle}"/>

                                    <!-- Ramp Up -->
                                    <TextBlock Grid.Row="1" Grid.Column="0"
                           Text="Ramp Up (ms)"
                           Style="{StaticResource ParamLabelStyle}"/>

                                    <Slider Grid.Row="1" Grid.Column="1"
                        Value="{Binding AntiRecoilRampUpMs}"
                        Minimum="10" Maximum="400"
                        TickFrequency="5"
                        Style="{StaticResource MacroSlider}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="2"
                           Text="{Binding AntiRecoilRampUpMs, StringFormat={}{0:F0}}"
                           Style="{StaticResource ParamValueStyle}"/>

                                    <!-- Ramp Down -->
                                    <TextBlock Grid.Row="2" Grid.Column="0"
                           Text="Ramp Down (ms)"
                           Style="{StaticResource ParamLabelStyle}"/>

                                    <Slider Grid.Row="2" Grid.Column="1"
                        Value="{Binding AntiRecoilRampDownMs}"
                        Minimum="10" Maximum="400"
                        TickFrequency="5"
                        Style="{StaticResource MacroSlider}"/>

                                    <TextBlock Grid.Row="2" Grid.Column="2"
                           Text="{Binding AntiRecoilRampDownMs, StringFormat={}{0:F0}}"
                           Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <TextBlock Margin="30,12,0,0"
                   Foreground="#88FFFFFF"
                   FontSize="11"
                   Text="Tip: Vertical Bias -1 = compensa verso il basso (classico), +1 = verso l’alto (scelta… creativa)."/>
                        </StackPanel>
                    </Expander>


                    <!-- ==================== AIM ASSIST ==================== -->
                    <Expander  IsExpanded="False" Margin="0,15,0,0">

                        <Expander.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Checkbox + titolo -->
                                <CheckBox Content="AIM ASSIST (Advanced)"
                                          IsChecked="{Binding AimAssistEnabled}"
                                          Style="{StaticResource MacroCheckBox}"
                                          FontSize="18"
                                          Margin="0"/>

                            </Grid>
                        </Expander.Header>

                        <StackPanel IsEnabled="{Binding AimAssistEnabled}">

                            <!-- ROTATION -->
                            <TextBlock Text="Rotation"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Margin="30,5,0,5"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Strength" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="0" Grid.Column="1" Value="{Binding RotationStrength}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding RotationStrength, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Cone Angle" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="1" Grid.Column="1" Value="{Binding RotationConeAngle}" Minimum="5" Maximum="90" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding RotationConeAngle, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Strafe Threshold" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="2" Grid.Column="1" Value="{Binding StrafeThreshold}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding StrafeThreshold, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Camera Threshold" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="3" Grid.Column="1" Value="{Binding CameraThreshold}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="3" Grid.Column="2" Text="{Binding CameraThreshold, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Target Motion" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="4" Grid.Column="1" Value="{Binding TargetMotionThreshold}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="4" Grid.Column="2" Text="{Binding TargetMotionThreshold, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>
                            </Grid>

                            <!-- SLOWDOWN -->
                            <TextBlock Text="Slowdown"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Margin="30,10,0,5"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Radius" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="0" Grid.Column="1" Value="{Binding SlowdownRadius}" Minimum="0.05" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding SlowdownRadius, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Strength" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="1" Grid.Column="1" Value="{Binding SlowdownStrength}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding SlowdownStrength, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Smooth (ms)" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="2" Grid.Column="1" Value="{Binding SlowdownSmoothMs}" Minimum="5" Maximum="200" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding SlowdownSmoothMs, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>
                            </Grid>

                            <!-- DRAG -->
                            <TextBlock Text="Drag"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Margin="30,10,0,5"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Strength" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="0" Grid.Column="1" Value="{Binding DragStrength}" Minimum="0" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding DragStrength, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Radius" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="1" Grid.Column="1" Value="{Binding DragRadius}" Minimum="0.05" Maximum="1" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding DragRadius, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Smooth (ms)" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="2" Grid.Column="1" Value="{Binding DragSmoothMs}" Minimum="5" Maximum="200" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding DragSmoothMs, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>
                            </Grid>

                            <!-- ADS MULTIPLIERS -->
                            <TextBlock Text="ADS Multipliers"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Margin="30,10,0,5"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Rotation Mult" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="0" Grid.Column="1" Value="{Binding AdsRotationMult}" Minimum="0.1" Maximum="2" TickFrequency="0.1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding AdsRotationMult, StringFormat={}{0:F1}}" Style="{StaticResource ParamValueStyle}"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Drag Mult" Style="{StaticResource ParamLabelStyle}"/>
                                <Slider Grid.Row="1" Grid.Column="1" Value="{Binding AdsDragMult}" Minimum="0.1" Maximum="2" TickFrequency="0.1" Style="{StaticResource MacroSlider}"/>
                                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding AdsDragMult, StringFormat={}{0:F1}}" Style="{StaticResource ParamValueStyle}"/>
                            </Grid>

                        </StackPanel>
                    </Expander>

                    <!-- ==================== 🎯 CRONUS ZEN AIM ASSIST ==================== -->
                    <!-- INSERISCI QUESTA SEZIONE DOPO L'EXPANDER "AIM ASSIST" (dopo riga 922) -->

                    <Expander IsExpanded="False" Margin="0,15,0,0">
                        <Expander.Header>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <CheckBox Grid.Column="0"
                                          Content="CRONUS ZEN"
                                          IsChecked="{Binding ZenCronusAimAssistEnabled}"
                                          Style="{StaticResource MacroCheckBox}"
                                          FontSize="18"
                                          Margin="0"/>

                                <StackPanel Grid.Column="1" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Right"
                        Margin="10,0,20,0">
                                    <TextBlock Text="⚡ ADVANCED"
                           Foreground="#FF6B35"
                           FontSize="11"
                           FontWeight="Bold"
                           Background="#33FF6B35"
                           Padding="6,2,6,2"
                           VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Expander.Header>

                        <StackPanel Margin="20,10,0,0">

                            <!-- INFO BANNER -->
                            <Border Background="#1A6366F1" 
                BorderBrush="#6366F1" 
                BorderThickness="1"
                CornerRadius="6"
                Padding="12"
                Margin="0,0,0,15">
                                <StackPanel>
                                    <TextBlock Text="⚙️ ALGORITMO ZEN REPLICATO"
                           Foreground="#A5B4FC"
                           FontWeight="Bold"
                           FontSize="13"
                           Margin="0,0,0,5"/>
                                    <TextBlock Text="5 componenti: Sticky Bubble • Micro-Correction • Shake Dampening • ADS Boost • Response Override"
                           Foreground="#9CA3AF"
                           FontSize="11"
                           TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>

                            <!-- === STICKY BUBBLE (Slowdown Zone) === -->
                            <TextBlock Text="🔵 Sticky Bubble (Slowdown Zone)"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Foreground="#60A5FA"
                   Margin="10,5,0,10"/>

                            <Border Background="#0F1F3F" 
                                    CornerRadius="6" 
                                    Padding="15" 
                                    Margin="10,0,25,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Bubble Radius" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="0" Grid.Column="1" Value="{Binding BubbleRadius}" Minimum="0.05" Maximum="0.5" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding BubbleRadius, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Bubble Strength" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="1" Grid.Column="1" Value="{Binding BubbleStrength}" Minimum="0" Maximum="0.95" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding BubbleStrength, StringFormat={}{0:P0}}" Style="{StaticResource ParamValueStyle}"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Smooth (ms)" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="2" Grid.Column="1" Value="{Binding BubbleSmoothMs}" Minimum="5" Maximum="200" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding BubbleSmoothMs, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <!-- === MICRO-CORRECTION (Pull Magnetico) === -->
                            <TextBlock Text="🧲 Micro-Correction (Pull Magnetico)"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Foreground="#F472B6"
                   Margin="10,15,0,10"/>

                            <Border Background="#1F0F3F" 
                CornerRadius="6" 
                Padding="15" 
                Margin="10,0,25,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Pull Radius" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="0" Grid.Column="1" Value="{Binding MicroCorrectionRadius}" Minimum="0.02" Maximum="0.3" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding MicroCorrectionRadius, StringFormat={}{0:F2}}" Style="{StaticResource ParamValueStyle}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Pull Strength" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="1" Grid.Column="1" Value="{Binding MicroCorrectionStrength}" Minimum="0" Maximum="0.5" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding MicroCorrectionStrength, StringFormat={}{0:P0}}" Style="{StaticResource ParamValueStyle}"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Smooth (ms)" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="2" Grid.Column="1" Value="{Binding MicroCorrectionSmoothMs}" Minimum="5" Maximum="200" TickFrequency="1" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding MicroCorrectionSmoothMs, StringFormat={}{0:F0}}" Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <!-- === SHAKE DAMPENING (Anti-Jitter) === -->
                            <TextBlock Text="✋ Shake Dampening (Anti-Jitter)"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Foreground="#FCD34D"
                   Margin="10,15,0,10"/>

                            <Border Background="#3F2F0F" 
                CornerRadius="6" 
                Padding="15" 
                Margin="10,0,25,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Shake Threshold" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="0" Grid.Column="1" Value="{Binding ShakeThreshold}" Minimum="0.5" Maximum="10" TickFrequency="0.1" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding ShakeThreshold, StringFormat={}{0:F1}}" Style="{StaticResource ParamValueStyle}"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Dampening" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="1" Grid.Column="1" Value="{Binding ShakeDampening}" Minimum="0" Maximum="0.95" TickFrequency="0.01" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding ShakeDampening, StringFormat={}{0:P0}}" Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <!-- === ADS BOOST & RESPONSE OVERRIDE === -->
                            <TextBlock Text="⚙️ Advanced Settings"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="14"
                   Foreground="#34D399"
                   Margin="10,15,0,10"/>

                            <Border Background="#0F3F2F" 
                CornerRadius="6" 
                Padding="15" 
                Margin="10,0,25,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="ADS Multiplier" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="0" Grid.Column="1" Value="{Binding ZenAdsMultiplier}" Minimum="1" Maximum="3" TickFrequency="0.1" Style="{StaticResource MacroSlider}"/>
                                    <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding ZenAdsMultiplier, StringFormat={}{0:F1}x}" Style="{StaticResource ParamValueStyle}"/>

                                    <CheckBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
                          Content="Response Curve Override"
                          IsChecked="{Binding UseResponseOverride}"
                          Foreground="{StaticResource TextSecondary}"
                          FontSize="12"
                          Margin="0,10,0,5"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Center Boost" Style="{StaticResource ParamLabelStyle}"/>
                                    <Slider Grid.Row="2" Grid.Column="1" Value="{Binding ResponseCenterBoost}" Minimum="1" Maximum="2" TickFrequency="0.1" Style="{StaticResource MacroSlider}" IsEnabled="{Binding UseResponseOverride}"/>
                                    <TextBlock Grid.Row="2" Grid.Column="2" Text="{Binding ResponseCenterBoost, StringFormat={}{0:F1}x}" Style="{StaticResource ParamValueStyle}"/>
                                </Grid>
                            </Border>

                            <!-- PRESET VELOCI -->
                            <TextBlock Text="📦 Quick Presets"
                   Style="{StaticResource SectionHeaderStyle}"
                   FontSize="13"
                   Foreground="#94A3B8"
                   Margin="10,15,0,10"/>

                            <StackPanel Orientation="Horizontal" 
                    HorizontalAlignment="Center"
                    Margin="0,5,0,15">
                                <Button Content="🔹 Subtle"
                    Background="#1E293B"
                    Foreground="#94A3B8"
                    BorderBrush="#334155"
                    BorderThickness="1"
                    Padding="15,8"
                    Margin="5"
                    ToolTip="BubbleStr: 0.65 | PullStr: 0.10"
                    Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>

                                <Button Content="⚡ Balanced"
                    Background="#1E293B"
                    Foreground="#60A5FA"
                    BorderBrush="#3B82F6"
                    BorderThickness="1"
                    Padding="15,8"
                    Margin="5"
                    ToolTip="BubbleStr: 0.85 | PullStr: 0.20 (Default)"
                    Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>

                                <Button Content="🔥 Aggressive"
                    Background="#1E293B"
                    Foreground="#F472B6"
                    BorderBrush="#EC4899"
                    BorderThickness="1"
                    Padding="15,8"
                    Margin="5"
                    ToolTip="BubbleStr: 0.92 | PullStr: 0.35"
                    Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>
                            </StackPanel>

                        </StackPanel>
                    </Expander>



                    <!-- ==================== HOLD BREATH (SNIPER) ==================== -->
                    <Border Margin="25,20,25,10">
                        <CheckBox Content="Hold Breath (Sniper)" 
                                  IsChecked="{Binding IsUsingSniperEnabled}"
                                  Style="{StaticResource MacroCheckBox}"/>
                    </Border>

                    <!-- ==================== AUTO PING ==================== -->
                    <Border Margin="25,0,25,10">
                        <StackPanel>
                            <CheckBox Content="Auto Ping" 
                                      IsChecked="{Binding AutoPingEnabled}"
                                      Style="{StaticResource MacroCheckBox}"/>

                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>


                            </Grid>
                        </StackPanel>
                    </Border>
                    <!-- ==================== RAPID FIRE==================== -->
                    <Border Margin="25,0,25,0">
                        <StackPanel>
                            <CheckBox Content="Rapid Fire" 
                                      IsChecked="{Binding RapidFireEnabled}"
                                      Style="{StaticResource MacroCheckBox}"/>
                            <Grid Margin="30,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="60"/>
                                </Grid.ColumnDefinitions>

                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- ==================== LOG REALTIME ==================== -->
            <Border Grid.Column="1" 
                    Background="{StaticResource CardBackground}" 
                    BorderBrush="{StaticResource BorderColor}" 
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" 
                               Text="ACTIVITY LOG" 
                               Style="{StaticResource SectionHeaderStyle}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,10"/>

                    <ScrollViewer Grid.Row="1" 
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding LogMessages}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" 
                                               TextWrapping="Wrap"
                                               Foreground="{StaticResource TextSecondary}"
                                               FontFamily="Consolas"
                                               FontSize="11"
                                               Margin="0,2,0,2"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

        </Grid>
    </Grid>
</Window>
